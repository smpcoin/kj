import{u as U,i as z,K as H,r as a,n as K,l as u,H as N,p as j,N as v,j as e,B as b,D as t,q as g}from"./vendor-CR9QeBO-.js";import{a as G}from"./arrow-Dt4f_FJz.js";import{c as w}from"../assets/index-9QO47Yxg.js";import{I as y,L as r,A as J}from"./index-C7yO8AkW.js";import{A as C,N as A}from"./index-CwKQTuFo.js";import{u as V}from"./useSequentialContractWrite-DRPrPaly.js";import{u as Y}from"./usePaymentCheck-J-Ic6eRN.js";import{M as S}from"./MiningMachineSystemLogic-BvMT4rBv.js";import"./helper-CPLEapGt.js";const xe=()=>{const{address:i}=U(),x=z(),c=H().state,[d,o]=a.useState(!1),[I,k]=a.useState(""),[m,D]=a.useState(0),[l,h]=a.useState(1),{executeSequentialCalls:L}=V(),{writeContractAsync:B}=K(),[E,p]=a.useState(c.length),M=()=>{x("/user")},f=a.useCallback(async()=>{try{const s=await u(w,{address:y,abi:N,functionName:"balanceOf",args:[i]});k(j(s))}catch(s){console.error(s)}},[i]);a.useEffect(()=>{f()},[f]);const P=async()=>{try{const s=await u(w,{address:r,abi:S,functionName:"getIDXAmount",args:[15]});D(+j(s))}catch(s){console.error(s)}};a.useEffect(()=>{P()},[]);const{isLoading:X,isAllowanceSufficient:T,isBalanceSufficient:F}=Y(v(String(Math.ceil(m*l*c.length)))),O=async()=>{try{if(X)return;if(!F){g.show({content:"余额不足",position:"center",duration:2e3});return}o(!0),T||await B({address:y,abi:N,functionName:"approve",args:[r,v(J)]});const s=c.map(R=>({address:r,abi:S,functionName:"payFuel",args:[R.id,l],onConfirmed:(W,_)=>{p(n=>n-1)},onCancel:(W,_)=>{p(n=>n-1)}})),$=await L(s);x("/user")}catch(s){g.show({content:"支付失败",position:"center",duration:2e3}),console.error(s),o(!1)}},q=()=>{h(s=>s===1?s:s-1)},Q=()=>{h(s=>s+1)};return e.jsxs("div",{className:"h-full overflow-scroll pb-[4rem]",children:[e.jsx("div",{className:"px-[21px] text-center ",children:e.jsxs("div",{className:" bg-[#1d1c25] rounded-xl text-white py-1",children:["你有",e.jsx("span",{className:"text-[red] text-[1rem] font-bold mx-1",children:E}),"笔交易待处理"]})}),e.jsxs("div",{className:"h-full overflow-scroll px-[21px] text-[.8125rem] relative",children:[e.jsxs("div",{className:"flex pt-4",children:[e.jsx(b,{onClick:M,className:"!p-[0] !rounded-2xl",loading:d,children:e.jsx("img",{src:G,alt:""})}),e.jsx("span",{className:"m-auto text-[17px] font-bold text-black",children:"添加燃料"})]}),e.jsxs("div",{className:"transfer-container mt-2",children:[e.jsxs("div",{className:"flex gap-2 items-center",children:["钱包IDX余额",e.jsx(C,{type:A.BALANCE,value:I,decimalSubLen:2,className:"ml-auto mr-1.5 text-[1rem] font-bold"}),e.jsx("div",{children:"IDX"})]}),e.jsx(t,{className:"!my-3"}),e.jsxs("div",{className:"flex",children:["购买月数（月）",e.jsxs("div",{className:"flex ml-auto text-white gap-8",children:[e.jsx("div",{className:"w-[22px] h-[22px] bg-[#c2c0cd] text-center rounded-[50%]",onClick:q,children:"-"}),e.jsx("div",{className:"text-black text-[18px] font-bold",children:l}),e.jsx("div",{className:"w-[22px] h-[22px] bg-[#504379] text-center rounded-[50%]",onClick:Q,children:"+"})]})]})]}),e.jsxs("div",{className:"transfer-container mt-2",children:[e.jsx("div",{className:"text-[.9375rem] font-bold mb-2 text-black",children:"已选矿机"}),e.jsx(t,{className:"!mt-[10px] !mb-[0]"}),e.jsxs("div",{className:"flex  py-2 text-[#777777] text-[.75rem]",children:[e.jsx("div",{className:"w-[90px]",children:"矿机类型"}),e.jsxs("div",{className:"flex-1 flex justify-between",children:[e.jsx("div",{className:"pl-[15px]",children:"燃料费单价"}),e.jsx("div",{children:"已选数量"})]})]}),e.jsx(t,{className:"!mt-[10px] !mb-[0]"}),e.jsxs("div",{className:"flex text-[.75rem] pt-2",children:[e.jsx("div",{className:"w-[90px] font-bold pl-[10px] ",children:"矿机"}),e.jsx("div",{className:"flex-1 mx-auto ",children:"15U 等值IDX/月"}),e.jsx("div",{className:"w-[3.125rem] text-center",children:c.length})]}),e.jsx(t,{className:"!my-2"}),e.jsxs("div",{className:"flex text-[.75rem]",children:[e.jsx("div",{className:"w-[90px] font-bold pl-[10px]",children:"母矿机"}),e.jsx("div",{className:"flex-1",children:"无需添加燃料费"}),e.jsx("div",{className:"w-[3.125rem] text-center",children:"/"})]})]}),e.jsxs("div",{className:"transfer-container mt-2",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"text-lg font-bold text-gray-800 text-[.9375rem]",children:"燃料费权益"}),e.jsx("div",{className:"text-[#666666] flex items-center text-[12px]",children:"注：激活后才能获得权益"})]}),e.jsx(t,{}),e.jsxs("div",{className:"flex text-[#666] text-[12px]",children:[e.jsx("div",{className:"w-[90px]",children:"矿机类型"}),e.jsx("div",{className:"flex-1 text-center",children:"权益"})]}),e.jsx(t,{}),e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[90px] font-bold pl-[10px]",children:"矿机"}),e.jsx("div",{className:"flex-1",children:"每1台矿机每日产出4个MIX积分，每日00:00:00~01:00:00内到账"})]}),e.jsx(t,{}),e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[90px] font-bold pl-[10px]",children:"母矿机"}),e.jsx("div",{className:"flex-1",children:"母矿机每10天产出1个矿机，母矿机不能产出MIX积分；"})]})]})]}),e.jsxs("div",{className:"w-full bg-white h-[3.8rem] flex items-center absolute bottom-0 px-[30px] justify-between",children:[e.jsxs("div",{children:[e.jsx("div",{className:"text-[.75rem]",children:"待支付 IDX"}),e.jsx("div",{className:"text-[#FF6D6D] text-[1.25rem]",children:e.jsx(C,{type:A.BALANCE,value:m*l*c.length,decimalSubLen:2,className:"font-bold"})})]}),e.jsx(b,{className:"!bg-black !text-white !rounded-3xl !ml-auto   !h-[40px] !w-[100px]",style:{fontSize:"15px"},onClick:O,disabled:d,children:"支付"})]})]})};export{xe as default};
