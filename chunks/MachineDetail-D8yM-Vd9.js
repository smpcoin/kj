import{i as Y,u as Z,r as a,K as $,U as P,p as r,l as ee,j as e,D as n,P as C,B as f,H as se,A as l,J as te,s as B,v as k,q as u}from"./vendor-CR9QeBO-.js";import{p as ae}from"./purple-mining-machine-qJc6x0wW.js";import{a as ie}from"./arrow-Dt4f_FJz.js";import{u as ne,w as ce,t as re}from"./usePopup-Ddlz1WPY.js";import{n as le}from"./no-open-CAtB8dC1.js";import{s as E}from"./started-CK8rpOhi.js";import{u as de}from"./user-machine-DxW_ZeqC.js";import{f as oe}from"./helper-CPLEapGt.js";import{A as h,N as p}from"./index-CwKQTuFo.js";import{c}from"../assets/index-CclTo9Qo.js";import{S as xe,L as v,I as me,C as T}from"./index-BmXiOrEl.js";import{M as fe}from"./MiningMachineSystemStorage-v65BGZKl.js";import{M as N}from"./MiningMachineSystemLogic-BvMT4rBv.js";const Pe=()=>{const d=Y(),{isConnected:g,address:o}=Z(),[F,R]=a.useState(!1),s=$().state;console.log("machine detail",s);const X=()=>{d(-1)},[x,H]=a.useState(0),[m,O]=a.useState(0),{data:j,isLoading:y,error:he}=P({address:v,abi:N,functionName:"getIDXAmount",args:[15]}),{data:b,isLoading:w,error:pe}=P({address:me,abi:se,functionName:"balanceOf",args:[o]});a.useEffect(()=>{w||O(Number(r(b)))},[w,b]),a.useEffect(()=>{y||H(Number(r(j)))},[y,j]);const _=()=>{te.confirm({content:"是否关停矿机",onConfirm:async()=>{try{const t=await B(c,{address:v,abi:N,functionName:"deactivateLP",args:[s.id]});await k(c,{hash:t,chainId:T}),u.show({content:"关停成功",position:"center"}),d(-1)}catch(t){u.show({content:"关停失败",position:"center"}),console.error(t)}}})},[z,A]=a.useState(!1),q=async()=>{try{A(!0);const t=await B(c,{address:v,abi:N,functionName:"activateMachineWithLP",args:[s.id]});await k(c,{hash:t,chainId:T}),u.show({content:"激活成功!",position:"center",duration:2e3}),d(-1)}catch(t){console.error(t)}finally{D(!1),A(!1)}},{setOpen:D,component:J}=ne({title:"",contentClassName:"",closeButtonClassName:"",content:e.jsxs("div",{className:"w-full",children:[e.jsx("div",{className:"text-[#6433EC] font-bold text-[15px] pt-2 pb-4",children:"激活矿机需支付打底池费用!"}),e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"font-bold text-[14px]",children:"待支付IDX"}),e.jsx("div",{className:"text-[#FF5050] font-bold text-[16px]",children:e.jsx(h,{type:p.BALANCE,value:+x,decimalSubLen:2,className:"ml-2 mr-1.5"})})]}),e.jsxs("div",{className:"flex justify-end text-[12px]",children:[e.jsx("div",{className:"text-[#686D6D]",children:"钱包余额："}),e.jsx("div",{className:"font-bold",children:e.jsx(h,{type:p.BALANCE,value:m,decimalSubLen:2,className:"ml-2 mr-1.5"})})]})]}),e.jsx(n,{}),e.jsx(f,{onClick:q,className:"!bg-black !rounded-3xl !text-white flex justify-center !py-2 w-full !text-[16px]",loading:z,disabled:m<x,children:m>x?"支付费用":"余额不足"})]})}),K=()=>{D(!0)},S=t=>t!==void 0&&t>0?+r(BigInt(t)):0,U=()=>{if(s.mtype===1){if(s.isActivatedStakedLP){const t=new Date().getTime()/1e3;return 90-l(t).diff(l(s.activatedAt),"day")}return 90}return Math.floor(360*(1440-S(s.producedMix))/1440)},W=()=>{if(s.mtype===1){if(s.isActivatedStakedLP){const i=new Date().getTime()/1e3;return(90-l(i).diff(l(s.activatedAt),"day"))/90*100}return 0}return 360*(1440-S(s.producedMix))/1440/360*100},G=t=>{if(s.mtype===2){const L=t/1440;return parseFloat(L.toFixed(2))}},Q=t=>{if(s.mtype===2)return t/1440/360*100},M=()=>s.isActivatedStakedLP,I=a.useCallback(async()=>{if(g)try{const t=await ee(c,{address:xe,abi:fe,functionName:"isMotherMachineDistributor",args:[o]});R(t)}catch(t){console.log(t)}},[o,g]);a.useEffect(()=>{I()},[I]);const V=()=>{if(s.isActivatedStakedLP&&s.isProducing)return E;if(s.destroyed)return ce;if(s.isActivatedStakedLP&&!s.isProducing&&s.mtype===1)return E;if(s.isActivatedStakedLP&&!s.isProducing&&s.mtype===2)return le;if(!s.isActivatedStakedLP)return re};return e.jsxs("div",{className:"h-full overflow-scroll px-[21px]",children:[J,e.jsxs("div",{className:"flex pt-4",children:[e.jsx("img",{src:ie,alt:"",onClick:X}),e.jsx("span",{className:"m-auto text-[17px] font-bold",children:"矿机详情"})]}),e.jsxs("div",{className:"transfer-container mt-4 relative",children:[e.jsx("img",{src:V(),alt:"",width:50,className:"absolute right-[15px]"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("img",{src:s.mtype===1?ae:de,alt:"",width:50}),e.jsxs("div",{className:"flex flex-col gap-1 text-[.68rem]",children:[e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-[#666666]",children:"矿机编号："}),e.jsx("div",{className:"font-bold text-gray-800",children:"#FDID9809"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-[#666666]",children:"矿机类型："}),e.jsx("div",{className:"font-bold text-[#BB7054]",children:s.mtype===1?"母矿机":"子矿机"})]}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("div",{className:"text-[#666666]",children:"激活日期："}),e.jsx("div",{className:"font-bold",children:M()?oe(s.activatedAt):""})]})]})]}),e.jsx(n,{}),e.jsxs("div",{className:"px-[20px] flex flex-col gap-2",children:[s.mtype===2&&e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[100px] text-[#666666]",children:"燃料费剩余："}),e.jsx(C,{percent:Q(s.fuelRemainingMinutes??0),className:"w-[45%]",style:{"--fill-color":"#615371"}}),e.jsxs("div",{className:"ml-2 font-bold",children:[G(s.fuelRemainingMinutes??0),"天"]})]}),e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[100px] text-[#666666]",children:"生命剩余："}),e.jsx(C,{percent:W(),className:"w-[45%]",style:{"--fill-color":"#615371"}}),e.jsxs("div",{className:"ml-2 font-bold",children:[U(),"天"]})]}),s.mtype===2&&e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[100px] text-[#666666]",children:"累计产出积分："}),e.jsxs("div",{className:" font-bold text-[#4F4E4F]",children:[e.jsx(h,{type:p.BALANCE,value:+r(BigInt(s.producedMix??0)),decimalSubLen:2,className:"ml-2 mr-1.5"}),"MIX"]})]})]}),s.isActivatedStakedLP&&e.jsx("div",{className:"mt-2",children:'注：请谨慎执行本操作，矿机将立即停止运行，并将底池费用退还到你的钱包， 所有燃料费将清零，矿机状态回退到"未激活"状态；'}),M()?e.jsx(f,{className:"!mt-4 w-full !rounded-2xl !border-[#d6d6d6]",onClick:_,style:{fontSize:"14px"},children:"关停矿机"}):!F&&e.jsx(f,{className:"!mt-4 w-full !rounded-2xl !border-[#d6d6d6] !bg-black !text-white",onClick:K,style:{fontSize:"14px"},children:"激活矿机"})]}),e.jsxs("div",{className:"transfer-container mt-4 ",children:[e.jsxs("div",{className:"flex gap-4",children:[e.jsx("div",{className:"text-lg font-bold text-gray-800 text-[14px]",children:"矿机权益"}),e.jsx("div",{className:"text-[#666666] flex items-center text-[12px]",children:"注：激活后才能获得权益"})]}),e.jsx(n,{className:"!my-3"}),e.jsxs("div",{className:"flex text-[#666] text-[12px]",children:[e.jsx("div",{className:"w-[90px]",children:"矿机类型"}),e.jsx("div",{className:"flex-1",children:"权益"})]}),e.jsx(n,{className:"!my-3"}),e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[90px] font-bold ",children:"母矿机"}),e.jsx("div",{className:"flex-1",children:"母矿机每10天产出1个矿机，母矿机不能产出MIX积分；"})]}),e.jsx(n,{className:"!my-3"}),e.jsxs("div",{className:"flex text-[12px]",children:[e.jsx("div",{className:"w-[90px] font-bold ",children:"矿机"}),e.jsx("div",{className:"flex-1",children:"每1台矿机每日产出4个MIX积分，每日00:00:00~01:00:00内到账"})]})]})]})};export{Pe as default};
