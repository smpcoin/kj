import{u as A,i as E,r as a,l as f,o as H,p as r,j as e,F,S as X}from"./vendor-CR9QeBO-.js";import{a as z}from"./arrow-Dt4f_FJz.js";import{f as j}from"./helper-CPLEapGt.js";import{c as o}from"../assets/index-Ciym-nWW.js";import{P as m}from"./index-URfKUYQd.js";import{E as D}from"./EmptyComp-DEO9vGp4.js";import{M as x}from"./MiningMachineProductionLogic-71W66ing.js";const G=()=>{const{address:n}=A(),R=E(),[h,C]=a.useState([]),[y,v]=a.useState(!1),L=()=>{R("/user")},N=a.useCallback(async()=>{try{v(!0);const i=await f(o,{address:m,abi:x,functionName:"getMixToChildRecords",args:[n,0,100]}),l=(await f(o,{address:m,abi:x,functionName:"getUserReleaseIds",args:[n]})).map(s=>({address:m,abi:x,functionName:"getReleaseInfo",args:[n,s]})),g=(await H(o,{contracts:l})).map(s=>({totalAmount:+r(s.result[0]),startTime:Number(s.result[1]),releasedAmount:+r(s.result[2]),releasableAmount:+r(s.result[3]),remainingAmount:+r(s.result[4]),remainingLockTime:Number(s.result[5]),remainingReleaseTime:Number(s.result[6])})),c=await f(o,{address:m,abi:x,functionName:"getClaimMixRecords",args:[n,0,100]}),k=i.reduce((s,T)=>(s.mixConsumed=s.mixConsumed+Number(r(T.mixConsumed)),s.timestamp=Number(i[i.length-1].timestamp),s.count=i.length,s),{type:0,mixConsumed:0,timestamp:0,count:0}),d=g.map(s=>({...s,type:1})),p=c.map(s=>({amount:Number(r(s.amount)),machineId:Number(s.machineId),timestamp:Number(s.timestamp),type:2})),I=[...d,...p];i.length>0&&I.unshift([k]),C(I)}catch(i){console.error(i)}finally{v(!1)}},[n]);a.useEffect(()=>{N()},[N]);const[b,S]=a.useState(0),w=a.useRef(null);a.useEffect(()=>{if(!w.current)return;const i=()=>{const t=window.innerHeight-70;S(t)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const M=({index:i,style:u,data:l})=>{const t=l[i],g=c=>{const d=[[()=>c===0,()=>"合成矿机"],[()=>c===1,()=>"兑换IDX"],[()=>c===2,()=>"矿机生产积分"]].find(p=>p[0]());return d?d[1]():"未知状态"};return e.jsx("div",{style:{...u,height:"136px"},children:e.jsxs("div",{className:"p-[20px] bg-white rounded-2xl text-[14px] flex flex-col gap-1 relative text-[#777777]",children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"操作类型:"}),e.jsx("div",{className:"text-black ",children:g(t.type)})]}),t.type===0&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"合成矿机数量:"}),e.jsx("div",{className:"text-black ",children:t.count})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"消耗MIX通证数:"}),e.jsx("div",{className:"text-black ",children:t.mixConsumed})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"矿机合成时间:"}),e.jsx("div",{className:"text-black ",children:t.timestamp?j(t.timestamp):"---"})]})]}),t.type===1&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"提取IDX数量:"}),e.jsx("div",{className:"text-black ",children:t.totalAmount})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"消耗IDX通证数:"}),e.jsx("div",{className:"text-black ",children:"100"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"提取时间:"}),e.jsx("div",{className:"text-black ",children:j(t.startTime)})]})]}),t.type===2&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"产出积分:"}),e.jsx("div",{className:"text-black ",children:t.amount})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"矿机编号:"}),e.jsx("div",{className:"text-black ",children:t.machineId})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"生成时间:"}),e.jsx("div",{className:"text-black ",children:j(t.timestamp)})]})]})]})})};return e.jsxs("div",{className:"h-full overflow-hidden px-[21px]",children:[e.jsxs("div",{className:"flex pt-4",children:[e.jsx("img",{src:z,alt:"",onClick:L}),e.jsx("span",{className:"m-auto text-[17px] ",children:"MIX账单"})]}),e.jsx("div",{ref:w,style:{height:`${b}px`,marginTop:"10px"},className:"no-scrollbar",children:y?e.jsx(X.Paragraph,{animated:!0,className:"customSkeleton"}):h.length>0?e.jsx(F,{height:b,width:"100%",itemCount:h.length,itemSize:145,itemData:h,children:M}):e.jsx(D,{})})]})};export{G as default};
