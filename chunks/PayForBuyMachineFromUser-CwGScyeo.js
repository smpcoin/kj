import{i as T,n as R,r as c,K as k,N as u,j as e,B as f,D as h,F as B,l as P,p as F,q as g,H as M,v as z,z as U}from"./vendor-CR9QeBO-.js";import{a as O}from"./arrow-Dt4f_FJz.js";import{c as j}from"../assets/index-T41FnVxa.js";import{L as d,A as X,I as _,C as W}from"./index-DsyTuzNV.js";import{A as N,N as v}from"./index-CwKQTuFo.js";import{u as q}from"./usePaymentCheck-rVn9twNS.js";import{M as y}from"./MiningMachineSystemLogic-BvMT4rBv.js";import"./helper-CPLEapGt.js";const J=a=>a===1?"母矿机":"子矿机",K=a=>{var t;const r=a+"",n=U.SHA256(r).toString(),i=((t=n.match(/[a-zA-Z]/g))==null?void 0:t.slice(0,4).join(""))||"ABCD",o=n.slice(10,14);return(i+o).toUpperCase()},ie=()=>{const a=T(),{writeContractAsync:r}=R(),[n,i]=c.useState(!1),o=k(),t=o.state,b=o.state.machineIds.map(s=>({id:s,mtype:o.state.orderType})),w=()=>{a("/user/history")},[m,A]=c.useState(0),x=c.useRef(null),[l,C]=c.useState("");c.useEffect(()=>{if(!x.current)return;const s=()=>{const H=window.innerHeight-370;A(H)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]);const I=async()=>{try{const s=await P(j,{address:d,abi:y,functionName:"getIDXAmount",args:[1]}),p=F(s);C(p)}catch(s){console.error(s)}};c.useEffect(()=>{I()},[]);const{isLoading:S,isBalanceSufficient:L,isAllowanceSufficient:D}=q(u(String(Math.ceil(t.price*+l)))),E=async()=>{try{if(S)return;if(!L){g.show({content:"余额不足",position:"center",duration:2e3});return}i(!0),D||await r({address:_,abi:M,functionName:"approve",args:[d,u(X)]});const s=await r({address:d,abi:y,functionName:"buyMachine",args:[t.orderId]});await z(j,{hash:s,chainId:W}),i(!1),a("/user/history")}catch(s){i(!1),g.show({content:"支付失败",position:"center",duration:2e3}),console.error(s)}};return e.jsxs("div",{children:[e.jsxs("div",{className:"h-full overflow-hidden px-[21px]",children:[e.jsxs("div",{className:"flex pt-4",children:[e.jsx(f,{onClick:w,className:"!p-[0] !rounded-2xl",loading:n,children:e.jsx("img",{src:O,alt:""})}),e.jsx("span",{className:"m-auto text-[17px] font-bold",children:"支付转让矿机费用"})]}),e.jsxs("div",{className:"transfer-container mt-4",children:[e.jsx("div",{className:"text-[16px] font-bold mb-4 text-black",children:"待转让详情"}),e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-2",children:["单价:",e.jsx("span",{className:"font-bold text-black",children:e.jsx(N,{type:v.BALANCE,value:t.price*+l/t.machineIds.length,decimalSubLen:2,className:"font-bold"})}),"IDX/台",e.jsx("span",{children:"（手续费30U/台）"})]}),e.jsxs("div",{className:"",children:["共计：",e.jsx("span",{className:"mr-2 text-[18px] font-bold text-black",children:t.machineIds.length}),"台"]})]}),e.jsx(h,{className:"!mt-[10px] !mb-[0]"}),e.jsxs("div",{className:"flex justify-between py-2 text-[#777777]",children:[e.jsx("div",{children:"#"}),e.jsx("div",{children:"矿机编号"}),e.jsx("div",{children:"矿机类型"})]}),e.jsx(h,{className:"!mt-[10px] !mb-[0]"}),e.jsx("div",{ref:x,style:{height:`${m}px`},className:"no-scrollbar",children:e.jsx(B,{height:m,width:"100%",itemCount:t.machineIds.length,itemSize:50,itemData:b,children:Q})})]})]}),e.jsxs("div",{className:"w-full bg-white h-[87px] flex items-center absolute bottom-0 px-[30px]",children:[e.jsxs("div",{children:[e.jsx("div",{children:"待支付 IDX"}),e.jsx("div",{className:"text-[#FF6D6D] text-[22px] font-bold",children:e.jsx(N,{type:v.BALANCE,value:t.price*+l,decimalSubLen:2,className:"mr-1.5  font-bold"})})]}),e.jsx(f,{className:"!bg-black !text-white !rounded-3xl !ml-auto   !h-[50px] !w-[100px]",onClick:E,loading:n,children:"支付"})]})]})},Q=({index:a,style:r,data:n})=>{const i=n[a];return e.jsxs("div",{style:{...r,height:"50px"},children:[e.jsxs("div",{className:"flex justify-between py-2",children:[e.jsx("div",{children:a+1}),e.jsxs("div",{children:["#",K(i.id)]}),e.jsx("div",{children:J(i.mtype)})]}),e.jsx(h,{className:"!my-[0]"})]})};export{ie as default};
