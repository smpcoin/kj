import{u as G,r as a,i as J,l as A,o as K,p as x,j as e,B as I,D as y,F as Z,q as B,s as ee,v as se,Y as k}from"./vendor-CR9QeBO-.js";import{a as te}from"./arrow-Dt4f_FJz.js";import{A as c,N as o}from"./index-CwKQTuFo.js";import{P as g,S as ae,L as ne,C as ie}from"./index-C7yO8AkW.js";import{u as le}from"./useSequentialContractWrite-DRPrPaly.js";import{c as u}from"../assets/index-9QO47Yxg.js";import{f as re}from"./helper-CPLEapGt.js";import{E as ce}from"./EmptyComp-DEO9vGp4.js";import{M as p}from"./MiningMachineProductionLogic-NN_EtVms.js";import{M as oe}from"./MiningMachineSystemStorage-v65BGZKl.js";import{M as de}from"./MiningMachineSystemLogic-BvMT4rBv.js";const me="/assets/black-exchange-9EuaH6EV.svg",xe="data:image/svg+xml,%3csvg%20viewBox='0%200%209.61328%2010.0059'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='9.61328125'%20height='10.0058594'%20fill='none'%20customFrame='%23000000'%3e%3cg%20id='组合%203359'%3e%3cpath%20id='矢量%20253'%20d='M0.75%203.25293L8.86328%203.25293L6.75%200.75293'%20stroke='rgb(255,255,255)'%20stroke-width='1.5'%20/%3e%3cpath%20id='矢量%20254'%20d='M0%202.5L8.11328%202.5L6%200'%20stroke='rgb(255,255,255)'%20stroke-width='1.5'%20transform='matrix(-1,0,0,-1,8.86328,9.25293)'%20/%3e%3c/g%3e%3c/svg%3e",ye=()=>{const{address:d}=G(),[m,N]=a.useState(""),[l,X]=a.useState([]),[D,R]=a.useState(""),[C,T]=a.useState(0),[H,F]=a.useState(0),[q,z]=a.useState(0),{executeSequentialCalls:O}=le(),[v,L]=a.useState(!1),P=J(),[S,U]=a.useState(0),E=a.useRef(null),[$,b]=a.useState(!1),h=a.useCallback(async()=>{try{const s=await A(u,{address:g,abi:p,functionName:"getUserReleaseIds",args:[d]}),r=s.map(n=>({address:g,abi:p,functionName:"getReleaseInfo",args:[d,n]})),i=(await K(u,{contracts:r})).map((n,t)=>({totalAmount:+x(n.result[0]),startTime:Number(n.result[1]),releasedAmount:+x(n.result[2]),releasableAmount:+x(n.result[3]),remainingAmount:+x(n.result[4]),remainingLockTime:Number(n.result[5]),remainingReleaseTime:Number(n.result[6]),id:Number(s[t])}));X(i),z(i.reduce((n,t)=>n+t.releasedAmount,0)),F(i.reduce((n,t)=>n+t.remainingAmount,0)),T(i.reduce((n,t)=>n+t.releasableAmount,0)),console.log("release Info",i)}catch(s){console.error(s)}},[d]);a.useEffect(()=>{h()},[h]);const j=a.useCallback(async()=>{try{const s=await A(u,{address:ae,abi:oe,functionName:"mixBalances",args:[d]});N(x(s))}catch(s){console.error(s)}},[d]);a.useEffect(()=>{j()},[j]);const Q=async()=>{try{const s=await A(u,{address:ne,abi:de,functionName:"getIDXAmount",args:[1]}),r=x(s);R(r)}catch(s){console.error(s)}};a.useEffect(()=>{Q()},[]);const V=async()=>{if(+m<100){B.show({content:"MIX余额不足",position:"center"});return}try{L(!0);const s=Math.floor(+m/100);console.log("aaa",s);const r=await ee(u,{address:g,abi:p,functionName:"convertMIXtoIDX",args:[s]});await se(u,{hash:r,chainId:ie}),B.show({content:"兑换成功",position:"center"}),j(),h()}catch(s){console.error(s)}finally{L(!1)}},W=()=>{k.clear()},Y=async()=>{try{const s=l.filter(t=>t.totalAmount!==t.releasedAmount);b(!0);const r=s.map(t=>({address:g,abi:p,functionName:"claimReleasedIdx",args:[t.id],onConfirmed:(M,w)=>{console.log(`Approval confirmed for call ${w+1}`)}})),f=await O(r);b(!1);const i=f.reduce((t,M,w)=>(M.success&&(t+=s[w].releasableAmount),t),0);f.find(t=>t.success)&&(h(),k.show({bodyStyle:{background:"#000000",color:"#ffffff",width:"75vw",padding:"15px",borderRadius:"20px"},showCloseButton:!0,closeOnMaskClick:!0,content:e.jsxs("div",{className:"pt-[15px] text-white text-[15px] flex flex-col gap-4",children:[e.jsx("div",{className:"text-[#B195FF]",children:"提示"}),e.jsxs("div",{children:[e.jsxs("div",{className:"mb-4",children:["你已成功提取",e.jsx(c,{type:o.BALANCE,value:i,decimalSubLen:2,className:"font-bold text-[15px]"}),"IDX，已存入你的钱包中。"]}),e.jsx("button",{className:"w-full bg-[#895EFF] rounded-3xl text-white py-2",onClick:W,children:"确认"})]})]})}))}catch(s){console.error(s),b(!1)}},_=()=>{P("/user")};return a.useEffect(()=>{if(!E.current)return;const s=()=>{const i=window.innerHeight-435;U(i)};return s(),window.addEventListener("resize",s),()=>window.removeEventListener("resize",s)},[]),e.jsxs("div",{className:"px-[21px]",children:[e.jsxs("div",{className:"flex pt-4 mb-4",children:[e.jsx(I,{onClick:_,className:"!p-[0] !rounded-2xl",loading:v,children:e.jsx("img",{src:te,alt:""})}),e.jsx("span",{className:"m-auto text-[19px] font-bold",children:"兑换IDX"})]}),e.jsxs("div",{style:{background:"#000",width:"100%",padding:"12px 20px",gap:"5px",borderRadius:"24px",color:"#fff"},children:[e.jsx("div",{className:"text-[12px]",children:"待兑换MIX"}),e.jsxs("div",{className:"pl-1 flex items-center justify-between",children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex   text-white items-center mt-4",children:[e.jsx(c,{type:o.BALANCE,value:m,decimalSubLen:2,className:"ml-2 mr-1.5  font-bold text-[22px]"}),e.jsx("div",{className:"text-[11px] pt-[8px] ",children:"MIX"})]}),e.jsxs("div",{className:"pl-2 text-[#939393] flex gap-1 items-center",children:["≈",e.jsx(c,{type:o.BALANCE,value:+m/2*+D,decimalSubLen:2,className:"text-[16px] "}),"IDX"]})]}),e.jsx(I,{disabled:v,onClick:V,className:" !bg-[#7334FE] !rounded-2xl  !mb-2 !flex !items-center  !text-[13px] !text-white !border-none",children:e.jsxs("div",{className:"flex gap-2",children:["兑换",e.jsx("img",{src:xe,alt:"",width:10})]})})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-[15px] mt-2",children:[e.jsxs("div",{className:"",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"text-[.6875rem]",children:"可提取IDX："}),e.jsx("div",{className:"pl-2 my-2",children:e.jsx(c,{type:o.BALANCE,value:C,decimalSubLen:2,className:"text-[1.5rem] font-bold mr-0.5"})})]}),e.jsx(I,{disabled:C===0||v,loading:$,onClick:Y,className:"w-full !py-2 !bg-[#7334FE] !rounded-2xl !text-[14px]  !mb-2 !flex !items-center !justify-center  !text-white !border-none",children:"提取到钱包"}),e.jsxs("div",{className:"flex mt-4",children:[e.jsxs("div",{className:"flex-1 flex flex-col items-end",children:[e.jsx("div",{children:"剩余未释放数量"}),e.jsxs("div",{className:"pl-2",children:[e.jsx(c,{type:o.BALANCE,value:H,decimalSubLen:2,className:"text-[1rem] font-bold mr-1.5"}),"IDX"]})]}),e.jsx(y,{direction:"vertical",style:{color:"#1677ff",borderColor:"#bdbdbd",height:"40px"}}),e.jsxs("div",{className:"flex-1 flex-col items-start",children:[e.jsx("div",{children:"已释放数量"}),e.jsxs("div",{className:"pl-2",children:[e.jsx(c,{type:o.BALANCE,value:q,decimalSubLen:2,className:"text-[1rem] font-bold mr-1.5"}),"IDX"]})]})]})]}),e.jsx(y,{}),e.jsx("div",{ref:E,style:{height:`${S}px`},className:"no-scrollbar",children:l.length>0?e.jsx(Z,{height:S,width:"100%",itemCount:l.length,itemSize:70,itemData:l,children:ue}):e.jsx(ce,{})})]})]})},ue=a.memo(({index:d,style:m,data:N})=>{const l=N[d];return e.jsxs("div",{style:{...m,height:"70px"},children:[e.jsxs("div",{className:"flex text-[12px] items-center gap-2",children:[e.jsx("img",{src:me,alt:"",width:37,height:37}),e.jsxs("div",{className:"w-full",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("div",{className:"font-bold",children:"兑换DIX"}),e.jsx("div",{className:"flex items-center",children:e.jsx(c,{type:o.BALANCE,value:l.totalAmount,decimalSubLen:4,className:"ml-2 mr-1.5  font-bold "})})]}),e.jsxs("div",{className:"flex justify-between mt-0.5",children:[e.jsx("div",{className:"text-[#7E7878] text-[.625rem]",children:re(l.startTime)}),e.jsxs("div",{className:"flex",children:["已释放：",e.jsx("div",{children:e.jsx(c,{type:o.BALANCE,value:l.releasedAmount,decimalSubLen:4,className:"ml-2 font-bold "})})]})]})]})]}),e.jsx(y,{})]})});export{ye as default};
