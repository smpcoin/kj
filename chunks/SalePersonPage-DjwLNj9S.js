import{j as e,x as R,y as O,P as oe,z as de,A as me,u as ue,r,i as he,l as H,o as N,F as xe,S as ge,E as fe,G as pe,H as D,p as F,q as be}from"./vendor-CR9QeBO-.js";import{u as we,c as Ne,i as je}from"./index-B_atygiO.js";import{c as x}from"../assets/index-CclTo9Qo.js";import{p as ve}from"./purple-mining-machine-qJc6x0wW.js";import{s as U}from"./selected-kuvggaMB.js";import{A as S,N as y}from"./index-CwKQTuFo.js";import{H as k,S as L,P as Ce,C as Se,I as ye,U as ke}from"./index-BmXiOrEl.js";import{M as A}from"./MiningMachineHistory-D9Ky5lmA.js";import{M}from"./MiningMachineSystemStorage-v65BGZKl.js";import{M as Le}from"./MiningMachineProductionLogic-NN_EtVms.js";import{t as Ae}from"./transfer-CmFgXUEi.js";import"./helper-CPLEapGt.js";const Me="data:image/svg+xml,%3csvg%20viewBox='0%200%2026.0188%2026.0186'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='26.0187988'%20height='26.0185547'%20fill='none'%20customFrame='%23000000'%3e%3cg%20id='组合%20240'%3e%3ccircle%20id='椭圆形'%20cx='13'%20cy='13'%20r='13'%20fill='rgb(255,255,255)'%20transform='matrix(1,0.000727309,-0.000727309,1,0.0187988,0)'%20/%3e%3ccircle%20id='椭圆形'%20cx='13'%20cy='13'%20r='12.1999998'%20stroke='rgb(151,151,151)'%20stroke-opacity='0'%20stroke-width='1.60000002'%20transform='matrix(1,0.000727309,-0.000727309,1,0.0187988,0)'%20/%3e%3cpath%20id='path'%20d='M6.26965%200.893975C6.41647%200.346702%206.95577%200%207.49365%200C8.08094%200%208.57082%200.398278%208.71765%200.944118C8.86447%201.5401%208.62024%202.03723%207.98353%202.33522C7.83671%202.38537%207.68988%202.53436%207.68988%202.68336L7.68988%203.72776L7.29741%203.72776L7.29741%202.58451C7.29741%202.48565%207.10118%202.38537%207.00377%202.33666C6.36706%201.98709%206.12282%201.48996%206.26965%200.893975ZM1.66588%208.59735C0.784941%208.59735%200.0494118%207.90108%200%207.05582C0%206.16184%200.686118%205.46557%201.66588%205.41543L1.66588%208.59735ZM12.7341%208.59735L12.7341%205.41686C13.6151%205.36672%2014.4%206.11313%2014.4%206.9584C14.4%207.85237%2013.6165%208.64749%2012.7341%208.59735ZM11.9026%204.2736L11.9026%209.6919C11.9026%2010.189%2011.8052%2010.2879%2011.2165%2010.338C11.2165%2010.338%209.03529%2010.3379%209.06071%2010.338C9.03529%2011.4612%205.38878%2011.5301%205.38871%2010.2879L2.98871%2010.2879C2.59624%2010.2879%202.44941%2010.1389%202.44941%209.79075L2.44941%204.22346C2.44941%203.82518%202.59624%203.72633%203.03671%203.72633L11.2659%203.72633C11.8038%203.67762%2011.9026%203.77647%2011.9026%204.2736ZM5.92659%206.95696C5.92659%206.50998%205.53412%206.16184%205.04565%206.16184C4.60518%206.16184%204.21271%206.50998%204.21271%206.95696L4.21271%207.00711C4.21271%207.45409%204.60518%207.85237%205.09365%207.85237C5.58353%207.80223%205.92659%207.45409%205.92659%206.95696ZM10.2367%207.00711C10.2367%206.56012%209.89365%206.16184%209.40376%206.16184L9.35435%206.16184C8.86447%206.16184%208.47341%206.50998%208.47341%206.95696C8.47341%207.40395%208.86588%207.80223%209.35435%207.80223C9.84424%207.85237%2010.2367%207.45409%2010.2367%207.00711Z'%20fill='rgb(44.4392,42.3482,50.0893)'%20fill-rule='nonzero'%20transform='matrix(1,0.000727309,-0.000727309,1,6.01367,7.00391)'%20/%3e%3c/g%3e%3c/svg%3e",Te="data:image/svg+xml,%3csvg%20viewBox='0%200%209.0022%2010.002'%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20width='9.00219727'%20height='10.0019531'%20fill='none'%20customFrame='%23000000'%3e%3cg%20id='组合%203095'%3e%3crect%20id='矩形%201506'%20width='8'%20height='4.94999981'%20x='0'%20y='0'%20rx='1'%20stroke='rgb(21,178,104)'%20stroke-linejoin='round'%20stroke-width='1'%20transform='matrix(1,0.000727309,-0.000727309,1,0.50293,4.54688)'%20/%3e%3cpath%20id='矢量%2082'%20d='M0%204.05L0%202.25C0%201.00736%200.994933%200%202.22222%200C3.44951%200%204.44444%201.00736%204.44444%202.25L4.44444%204.05'%20fill-rule='nonzero'%20stroke='rgb(21,178,104)'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke-width='1'%20transform='matrix(1,0.000727309,-0.000727309,1,2.28369,0.498047)'%20/%3e%3cpath%20id='矢量%2083'%20d='M0%200L0%201.35'%20stroke='rgb(21,178,104)'%20stroke-linecap='round'%20stroke-linejoin='round'%20stroke-width='1'%20transform='matrix(1,0.000727309,-0.000727309,1,4.50146,6.34961)'%20/%3e%3c/g%3e%3c/svg%3e",Be={"machine-name":"_machine-name_qy7om_1"},Pe=s=>s===1?"母矿机":"子矿机",Ee=(s,n)=>(90-(s+n)*10)/90*100,Ie=(s,n)=>90-(s+n)*10,He=s=>{var p;const n=s+"",u=de.SHA256(n).toString(),d=((p=u.match(/[a-zA-Z]/g))==null?void 0:p.slice(0,4).join(""))||"ABCD",f=u.slice(10,14);return(d+f).toUpperCase()},De=s=>me.unix(s).format("YYYY/MM/DD HH:mm:ss"),Fe=({item:s,onLeftClick:n,onRightClick:u})=>e.jsxs("div",{className:"container-wrap flex justify-between mt-4 text-[.68rem]",children:[e.jsxs("div",{className:"flex relative",onClick:()=>n(s),children:[e.jsx(R,{checked:s.checked,icon:d=>d?e.jsx("img",{src:U,alt:"",width:16,height:16}):e.jsx("div",{className:"border border-[#a5a4a4] w-[1rem] h-[1rem] rounded-[50%]"})}),e.jsx("img",{src:ve,alt:"",width:58,className:"mx-2"})]}),e.jsxs("div",{className:"basis-5/7  h-full flex flex-col gap-1",onClick:()=>u(s),children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("div",{className:O(Be["machine-name"],"flex rounded-3xl pr-3"),children:["#",He(s.id),e.jsx("div",{className:"text-white ml-3",children:Pe(s.mtype)})]}),e.jsxs("div",{className:"text-[#15b268] flex gap-1",children:[e.jsx("img",{src:Te,alt:"",width:13}),s.activatedAt>0?"已激活":"未激活"]})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"生命剩余"}),e.jsx(oe,{percent:Ee(s.producedChildCount,s.unclaimedChildCount),className:"w-[60%]",style:{"--fill-color":"#615371"}}),e.jsxs("div",{children:[Ie(s.producedChildCount,s.unclaimedChildCount),"天"]})]}),e.jsxs("div",{className:"flex justify-end",children:["创建于 ",De(s.createTime)]})]})]},s.id),$e=()=>{const{address:s}=ue(),[n,u]=r.useState([]),[d,f]=r.useState(!1),[p,z]=r.useState(0),T=r.useRef(null),[m,g]=r.useState([]),C=he(),[_,Z]=r.useState(""),[Q,Y]=r.useState(""),[q,G]=r.useState(""),[X,B]=r.useState(!1),[J,$]=r.useState("0"),[K,V]=r.useState("0"),[j,W]=r.useState(0),P=r.useCallback(async()=>{try{const t=await H(x,{address:k,abi:A,functionName:"getSellerOrderIds",args:[s,0,100]});console.log("orderIds",t);const o=t.map(l=>Number(l)).map(l=>({address:k,abi:A,functionName:"allOrders",args:[l]})),c=(await N(x,{contracts:o})).map(l=>({orderId:Number(l.result[0]),seller:l.result[1],buyer:l.result[2],createTime:String(l.result[3]),status:l.result[4],orderType:l.result[5]})),h=c.filter(l=>l.status===0);W(h.length),console.log("sale person transfer history detail",c)}catch(t){console.error(t)}},[s]);r.useEffect(()=>{P()},[P]),r.useEffect(()=>{d&&g(n)},[d,n]),r.useEffect(()=>{m.length===n.length&&m.length>0&&f(!0)},[m.length,n.length]);const ee=()=>{u(t=>{const i=t.map(o=>({...o,checked:!d}));return g(d?[]:i),i}),f(!d)},E=r.useCallback(async()=>{B(!0);try{const i=(await H(x,{address:L,abi:M,functionName:"getOwnerToMachineIds",args:[s]})).map(a=>Number(a)),o=i.map(a=>({address:L,abi:M,functionName:"getMachineLifecycle",args:[a]})),c=(await N(x,{contracts:o})).map((a,w)=>({activatedAt:Number(a.result.activatedAt),createTime:Number(a.result.createTime),expiredAt:Number(a.result.expiredAt),destroyed:a.result.destroyed,isActivatedStakedLP:a.result.isActivatedStakedLP,isFuelPaid:a.result.isFuelPaid,isProducing:a.result.isProducing,lastProduceTime:Number(a.result.lastProduceTime),mtype:a.result.mtype,producedChildCount:Number(a.result.producedChildCount),producedHours:Number(a.result.producedHours),id:i[w],checked:!1,status:a.status})),h=c.map(a=>({address:Ce,abi:Le,functionName:"viewMachineProduction",args:[a.id]})),l=await N(x,{contracts:h}),I=c.map((a,w)=>({...a,unclaimedChildCount:Number(l[w].result[2])})),ce=I.map(a=>({address:L,abi:M,functionName:"_isOnSale",args:[a.id]})),le=await N(x,{contracts:ce});let v=I.map((a,w)=>({...a,isOnSale:le[w].result}));v=v.filter(a=>!a.isOnSale),u(v),console.log("sale person machine list",v)}catch(t){console.error(t)}finally{B(!1)}},[s]);r.useEffect(()=>{E()},[E]),r.useEffect(()=>{(async()=>{try{const i=await fe(x,{address:s,chainId:Se}),o=pe(i.value,i.decimals);Z(o);const c=await N(x,{contracts:[{address:ye,abi:D,functionName:"balanceOf",args:[s]},{address:ke,abi:D,functionName:"balanceOf",args:[s]},{address:k,abi:A,functionName:"getAddressStats",args:[s]}]});Y(F(c[0].result)),G(F(c[1].result));const h=c[2].result;console.log("motherMachineStatus",h),$(String(h[0])),V(String(h[2]))}catch(i){console.error(i)}})()},[s]);const se=r.useCallback(t=>{u(i=>{const o=i.map(c=>c.id===t.id?{...c,checked:!c.checked}:c);if(!t.checked)g(d?n:[...m,t]);else{const c=m.filter(h=>h.id!==t.id);g(c),f(!1)}return o})},[d,n,m]),te=t=>{C("/user/machineDetail",{state:t})},ae=r.memo(({index:t,style:i,data:o})=>{const b=o[t];return e.jsx("div",{style:{...i,height:"70px"},children:e.jsx(Fe,{item:b,onLeftClick:se,onRightClick:te})})});r.useEffect(()=>{if(!T.current)return;const t=()=>{const o=window.innerHeight;z(o)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const re=()=>{if(m.length===0){be.show({content:"请选择要转让的矿机",position:"center",duration:2e3});return}C("/transfer-machine",{state:m})},ne=t=>t?e.jsx("img",{src:U,alt:"",width:16,height:16}):e.jsx("div",{className:"border border-[#a5a4a4] w-[1rem] h-[1rem] rounded-[50%]"}),ie=()=>{C("/sale-person/history")};return e.jsxs("div",{className:"pt-4 flex flex-col justify-between h-full overflow-scroll",children:[e.jsxs("div",{className:"px-[21px]",children:[e.jsxs("div",{className:"bg-[#09090a] rounded-2xl text-white p-5 text-[1rem] relative",children:[e.jsx("div",{className:"text-[#c6c6c6] text-[11px] font-[400]",children:"我的钱包余额"}),e.jsxs("div",{className:"flex items-center mt-5 mb-2",children:[e.jsx("div",{className:"bg-[#895eff] rounded-[50%] w-[19px] h-[19px]  "}),e.jsxs("div",{children:[e.jsx(S,{type:y.BALANCE,value:Q,decimalSubLen:2,className:"ml-2 mr-1.5"}),e.jsx("span",{className:"text-[#c6c6c6] text-[12px] font-[400]",children:"IDX"})]})]}),e.jsxs("div",{className:"flex mb-2",children:[e.jsx("img",{src:we,alt:"",width:19,height:19}),e.jsxs("div",{children:[e.jsx(S,{type:y.BALANCE,value:q,decimalSubLen:2,className:"ml-2 mr-1.5"}),e.jsx("span",{className:"text-[#c6c6c6] text-[12px] font-[400]",children:"USDT"})]})]}),e.jsxs("div",{className:" flex",children:[e.jsx("img",{src:Ne.bscSvg,alt:"",width:19,height:19}),e.jsxs("div",{children:[e.jsx(S,{type:y.BALANCE,value:_,decimalSubLen:2,className:"ml-2 mr-1.5"}),e.jsx("span",{className:"text-[#c6c6c6] text-[12px] font-[400]",children:"BNB"})]})]}),e.jsx("img",{src:je,alt:"",width:180,height:87,className:"absolute bottom-[20px] right-[20px]"})]}),e.jsxs("div",{className:"bg-[#09090a] rounded-t-2xl text-white  p-5 text-[1.125rem] mt-4",children:[e.jsx("div",{className:"text-white text-[.75rem] ",children:"我的母矿机总数"}),e.jsxs("div",{className:"flex items-center py-1",children:[e.jsx("img",{src:Me,alt:"",width:26,height:26}),e.jsxs("div",{children:[e.jsx("span",{className:"text-[1.5rem] font-[400] mx-2",children:J}),e.jsx("span",{className:"text-[.875rem] font-[400]",children:"台"})]})]})]}),e.jsxs("div",{className:"bg-white text-[#636262] rounded-b-2xl p-3 text-[.875rem] flex justify-between",children:[e.jsxs("div",{children:["累计转出:",e.jsx("span",{className:"font-bold text-[1rem] mx-2",children:K}),"台"]}),e.jsxs("div",{className:"flex gap-2 items-center",onClick:ie,children:["矿机转让记录",e.jsx("div",{className:O([j===0?"bg-[#E3E3E3]":"bg-[#ff5353]"],[j===0?"text-black":"text-white"],"rounded-[50%]  w-[20px] h-[20[px]  flex justify-center items-center"),children:j===0?e.jsx(e.Fragment,{children:"i"}):j})]})]}),e.jsx("div",{className:"pt-4",children:e.jsx(R,{className:"mr-6",checked:d,icon:t=>ne(t),onClick:ee,style:{"--font-size":"13px","--gap":"6px"},children:"全选"})}),e.jsx("div",{ref:T,style:{height:`${p}px`},className:"no-scrollbar mb-[4rem]",children:X?e.jsx(ge.Paragraph,{animated:!0,className:"customSkeleton"}):e.jsx(xe,{height:p,width:"100%",itemCount:n.length,itemSize:105,itemData:n,children:ae})})]}),e.jsxs("div",{className:"fixed bottom-0  w-full bg-white h-[4rem] flex items-center mt-auto px-[21px]",onClick:re,children:[m.length>0&&e.jsx("div",{className:"bg-[#F1F1F3] rounded-[50%] w-[32px] h-[32px] flex justify-center items-center text-[#895FFE] font-bold",children:m.length}),e.jsxs("div",{className:"flex flex-col items-center justify-center mx-auto",children:[e.jsx("img",{src:Ae,alt:"",width:18}),e.jsx("span",{className:"text-[14px] mt-1",children:"转让矿机"})]})]})]})};export{$e as default};
