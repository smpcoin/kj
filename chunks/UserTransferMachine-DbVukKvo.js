import{i as E,K as U,r as i,j as e,B as D,T as k,D as u,F as z,l as F,p as X,q as f,s as P,v as V,z as O}from"./vendor-CR9QeBO-.js";import{a as $}from"./arrow-Dt4f_FJz.js";import{v as q}from"./validateAddress-BE2p6uyu.js";import{c as v}from"../assets/index-CclTo9Qo.js";import{L as S,C as J}from"./index-BmXiOrEl.js";import{M as H}from"./MiningMachineSystemLogic-BvMT4rBv.js";const K=d=>{var o;const j=d+"",n=O.SHA256(j).toString(),c=((o=n.match(/[a-zA-Z]/g))==null?void 0:o.slice(0,4).join(""))||"ABCD",x=n.slice(10,14);return(c+x).toUpperCase()},ee=()=>{const d=E(),n=U().state,[c,x]=i.useState(""),[o,g]=i.useState(!1),w=()=>{d("/user/toBeActivatedMachine")},[N,I]=i.useState(0),b=i.useRef(null),[y,A]=i.useState(0);i.useEffect(()=>{if(!b.current)return;const t=()=>{const s=window.innerHeight-540;I(s)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const C=async()=>{var a,r;if(!((r=(a=q)==null?void 0:a.EVM)==null?void 0:r.call(a,c))){f.show({content:"请输入合法的BNB地址",position:"center",duration:2e3});return}try{const s=n.map(l=>l.id);f.show({content:"转让中...",position:"center",duration:0}),g(!0);const h=await P(v,{address:S,abi:H,functionName:"createInternalMachineOrder",args:[c,s]});await V(v,{hash:h,chainId:J}),f.clear(),w()}catch(s){console.error(s)}finally{g(!1)}},T=t=>{x(t)},L=async()=>{try{const t=await F(v,{address:S,abi:H,functionName:"getIDXAmount",args:[1]}),a=X(t);A(+a)}catch(t){console.error(t)}};i.useEffect(()=>{L()},[]);const M=n.reduce((t,a)=>{let s=(150*(1-a.producedHours/360)-30)*y;return s<0&&(s=0),t+s},0),R=({index:t,style:a,data:r})=>{const s=r[t],h=m=>150*(1-m/360)-30===120?"新矿机":"二手矿机",l=m=>{let p=(150*(1-m/360)-30)*y;return p<0&&(p=0),p};return e.jsxs("div",{style:{...a,height:"50px"},children:[e.jsxs("div",{className:"flex py-2 text-[12px]",children:[e.jsx("div",{className:"w-[55px] ",children:t+1}),e.jsxs("div",{className:"w-[100px] mr-[10px]",children:["#",K(s.id)]}),e.jsx("div",{className:"w-[80px] mr-auto",children:h(s.producedHours)}),e.jsxs("div",{className:`${l(s.producedHours)===0&&"text-[red]"}`,children:[l(s.producedHours)," IDX"]})]}),e.jsx(u,{className:"!my-[0]"})]})};return e.jsxs("div",{children:[e.jsxs("div",{className:"h-full overflow-hidden px-[21px] text-[14px] relative",children:[e.jsxs("div",{className:"flex pt-4",children:[e.jsx(D,{onClick:w,className:"!p-[0] !rounded-2xl",loading:o,children:e.jsx("img",{src:$,alt:""})}),e.jsx("span",{className:"m-auto text-[17px] font-bold text-black",children:"转让矿机"})]}),e.jsxs("div",{className:"transfer-container mt-4",children:[e.jsx("div",{className:"text-[14px] font-bold mb-4 text-black",children:"接收方钱包地址"}),e.jsx(k,{value:c,rows:2,className:"bg-[#ececee] rounded-3xl p-3",placeholder:"输入对方的钱包地址",onChange:T,style:{"--font-size":"14px"}})]}),e.jsxs("div",{className:"transfer-container mt-4 text-[14px]",children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("div",{className:" font-bold  text-black",children:"待转让详情"}),e.jsxs("div",{className:"text-[12px]",children:["共计：",e.jsx("span",{className:"mr-2 text-[18px] font-bold text-black",children:n.length}),"台"]})]}),e.jsx("div",{className:"flex justify-between text-[11px] mb-4",children:"(每台手续费30U等值IDX)"}),e.jsx(u,{className:"!mt-[10px] !mb-[0]"}),e.jsxs("div",{className:"flex justify-between py-2 text-[#777777] text-[12px]",children:[e.jsx("div",{children:"#"}),e.jsx("div",{children:"矿机编号"}),e.jsx("div",{children:"矿机类型"}),e.jsx("div",{children:"每台收益"})]}),e.jsx(u,{className:"!mt-[10px] !mb-[0]"}),e.jsx("div",{ref:b,style:{height:`${N}px`},className:"no-scrollbar",children:e.jsx(z,{height:N,width:"100%",itemCount:n.length,itemSize:50,itemData:n,children:R})})]})]}),e.jsxs("div",{className:"w-full bg-white h-[4rem] flex items-center absolute bottom-0 px-[30px]",children:[e.jsxs("div",{children:[e.jsx("div",{children:"待收款 IDX"}),e.jsx("div",{className:"text-[#FF6D6D] text-[22px]",children:M})]}),e.jsx(D,{className:"!bg-black !text-white !rounded-3xl !ml-auto   !h-[40px] !w-[100px]",style:{fontSize:"15px"},onClick:C,loading:o,children:"转出矿机"})]})]})};export{ee as default};
