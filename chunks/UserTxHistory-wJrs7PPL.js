import{i as N,u as q,r as i,j as s,D as T,l as J,p as _,J as G,s as K,v as Q,q as w,V as W}from"./vendor-CR9QeBO-.js";import{a as Y}from"./arrow-Dt4f_FJz.js";import{n as Z}from"./next-arrow-_-KGsGbq.js";import{f as H,s as C}from"./helper-CPLEapGt.js";import{c as m}from"../assets/index-CclTo9Qo.js";import{L as I,C as ee}from"./index-BmXiOrEl.js";import{o as se}from"./orderStore-CEoCXZ7c.js";import{A,N as k}from"./index-CwKQTuFo.js";import{M as R}from"./MiningMachineSystemLogic-BvMT4rBv.js";const xe=()=>{const S=N(),{address:r}=q(),L=se.getOrders().filter(t=>t.listedAt&&t.status===1&&t.seller===r||t.seller===r&&!t.listedAt||t.buyer===r&&!t.listedAt),D=()=>{S("/user")},[f,E]=i.useState(0),p=i.useRef(null),[g,z]=i.useState(0),B=async()=>{try{const t=await J(m,{address:I,abi:R,functionName:"getIDXAmount",args:[1]});z(Number(_(t)))}catch(t){console.error(t)}};i.useEffect(()=>{B()},[]),i.useEffect(()=>{if(!p.current)return;const t=()=>{const d=window.innerHeight-120;E(d)};return t(),window.addEventListener("resize",t),()=>window.removeEventListener("resize",t)},[]);const M=()=>{const t={};return{get:a=>t[a]||null,set:(a,n)=>(t[a]=n,t[a]),clear:()=>{for(const a in t)delete t[a]},reset:a=>{delete t[a]},has:a=>t[a]!==void 0}},O=i.forwardRef(({index:t,style:a,data:n,onHeightChange:d},y)=>{const c=i.useRef(null),[o,v]=i.useState(0);i.useEffect(()=>{const l=c.current;if(!l)return;const j=()=>{const h=l.getBoundingClientRect().height;h!==o&&(v(h),d(t,h))};j();const b=new ResizeObserver(j);return b.observe(l),()=>b.disconnect()},[t,d,o]);const e=n.items[t],u=N(),x=()=>e.status===0,F=()=>{e.orderType===1?e.status===0&&u("/user/payForBuyMachine",{state:e}):e.orderType===2&&e.status===0&&e.seller!==r&&u("/user/userToUserPay",{state:e})},X=()=>e.orderType===1?"买入母矿机":e.orderType===2&&e.seller===r?"卖出矿机":e.orderType===2&&e.buyer===r?"买入矿机":"矿机挂售卖出",P=()=>{if(e.status===1)return"已完成";if(e.status===0&&e.orderType===1)return"待支付";if(e.status===2&&e.orderType===1)return"已撤销";if(e.status===0&&e.orderType===2&&e.buyer!==r)return"等待对方支付";if(e.status===0&&e.orderType===2&&e.buyer===r)return"待支付";if(e.status===2&&e.orderType===2)return"已取消";if(e.orderType===3&&e.status===0)return"售卖中";if(e.orderType===3&&e.status===2)return"已取消";if(e.orderType===3&&e.status===3)return"已售给平台"},V=()=>{if(e.orderType===1&&e.status===0&&e.buyer!==r)return"待对方支付合计";if(e.orderType===1&&e.status===0&&e.buyer===r)return"待支付合计";if(e.orderType===1&&e.status===1&&e.buyer===r)return"已支付合计";if(e.orderType===1&&e.status===1&&e.buyer!==r)return"已支付合计";if(e.orderType===2&&e.status===0&&e.buyer!==r)return"待对方支付合计";if(e.orderType===2&&e.status===0&&e.buyer===r)return"待支付合计";if(e.orderType===2&&e.status===1&&e.buyer!==r)return"对方已支付合计";if(e.orderType===2&&e.status===1&&e.buyer===r)return"已支付合计"},$=()=>{G.confirm({content:"是否撤回交易",onConfirm:async()=>{try{const l=await K(m,{address:I,abi:R,functionName:"cancelInternalMachineOrder",args:[e.orderId]});await Q(m,{hash:l,chainId:ee}),w.show({content:"撤回成功",position:"center"}),u("/user")}catch(l){w.show({content:"撤回失败",position:"center"}),console.error(l)}}})};return s.jsxs("div",{ref:c,style:{...a},children:[s.jsx("div",{className:"h-[10px]"}),s.jsxs("div",{className:"transfer-container text-[12px] flex flex-col gap-1 relative text-[#777777]",onClick:F,children:[s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("div",{children:"交易类型:"}),s.jsx("div",{className:"text-black ",children:X()}),s.jsx("div",{className:` ${x()?"bg-[#ff4949]":"bg-[#6e638b]"} ml-auto text-white px-3 py-0.5 rounded-3xl text-[.6875rem]`,children:P()})]}),[1,2].includes(e.orderType)?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:"交易单价:"}),s.jsxs("div",{className:"text-black ",children:[s.jsx(A,{type:k.BALANCE,value:e.price*g/e.machineIds.length,decimalSubLen:2,className:"mr-1.5"}),"IDX / 台"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:"订单数量:"}),s.jsxs("div",{className:"text-black ",children:[e.machineIds.length," 台"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:"发起时间:"}),s.jsx("div",{className:"text-black ",children:H(+e.createTime)})]}),x()&&e.orderType===1&&s.jsx("div",{children:s.jsx("img",{src:Z,alt:"",className:"absolute right-[30px] top-[95px]",width:30,height:30})}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:"接收方钱包地址:"}),s.jsx("div",{className:"text-black ",children:C(e.buyer,4)})]}),s.jsx(T,{className:"!my-1"}),s.jsxs("div",{className:"flex items-end gap-2 py-1",children:[s.jsx("div",{className:"text-[14px]",children:V()}),s.jsx("div",{className:"text-[16px]  flex items-end text-black font-bold",children:s.jsx(A,{type:k.BALANCE,value:e.price*g,decimalSubLen:2,className:""})}),s.jsx("div",{children:"IDX"})]}),x()&&e.orderType===2&&e.seller===r&&s.jsx("button",{className:"rounded-3xl border border-dashed border-[#e1e1e1] text-[16px] text-center py-1",onClick:$,children:"撤回"})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:"收益单价:"}),s.jsxs("div",{className:"text-black ",children:[e.priceInIdx," IDX / 台"]})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:"订单数量:"}),s.jsx("div",{className:"text-black ",children:"1 台"})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:"交易时间:"}),s.jsx("div",{className:"text-black ",children:e.status===1?H(e.listedAt):""})]}),s.jsxs("div",{className:"flex gap-2",children:[s.jsx("div",{children:"购买方钱包地址:"}),s.jsx("div",{className:"text-black ",children:e.buyer!=="0x0000000000000000000000000000000000000000"?C(e.buyer,4):""})]}),s.jsx(T,{className:"!my-2"})]})]})]})}),U=({items:t})=>{const a=i.useRef(null),n=i.useRef(M()).current,d=i.useCallback((c,o)=>{var e;n.get(c)!==o&&(n.set(c,o),(e=a.current)==null||e.resetAfterIndex(c))},[n]),y=i.useCallback(c=>n.get(c),[n]);return s.jsx("div",{ref:p,style:{height:`${f}px`,marginTop:"10px"},className:"no-scrollbar",children:s.jsx(W,{ref:a,height:f,width:"100%",itemCount:t.length,itemSize:y,itemData:{items:t,heightCache:n},children:c=>s.jsx(O,{...c,onHeightChange:d})})})};return s.jsxs("div",{className:"h-full overflow-hidden px-[21px]",children:[s.jsxs("div",{className:"flex pt-4",children:[s.jsx("img",{src:Y,alt:"",onClick:D}),s.jsx("span",{className:"m-auto text-[17px] font-bold",children:"交易记录"})]}),s.jsx(U,{items:L}),";"]})};export{xe as default};
