import{r as a,u as fe,l as X,o as y,j as e,L as he,y as je,M as we,x as Ce,P as Re,z as Ue,p as H,i as ye,B as be,D as ge,F as Se,S as Xe,E as ze,G as We,H as Ne,q as Ie,I as $e}from"./vendor-CR9QeBO-.js";import{o as ne}from"./orderStore-CEoCXZ7c.js";import{c as m}from"../assets/index-T41FnVxa.js";import{H as oe,L as T,S as me,P as Qe,C as Ke,I as Le,U as qe}from"./index-DsyTuzNV.js";import{M as ue}from"./MiningMachineHistory-D9Ky5lmA.js";import{M as E}from"./MiningMachineSystemLogic-BvMT4rBv.js";import{u as Ge,c as Je,i as Ze}from"./index-B_atygiO.js";import{s as Ae}from"./selected-kuvggaMB.js";import{n as Ve}from"./no-open-CAtB8dC1.js";import{s as Ye}from"./started-CK8rpOhi.js";import{u as ve}from"./user-machine-DxW_ZeqC.js";import{A as P,N as O}from"./index-CwKQTuFo.js";import{E as Be}from"./EmptyComp-DEO9vGp4.js";import{M as xe}from"./MiningMachineSystemStorage-v65BGZKl.js";import{M as et}from"./MiningMachineProductionLogic-NN_EtVms.js";import{n as tt}from"./next-arrow-_-KGsGbq.js";import{s as st,f as at}from"./helper-CPLEapGt.js";import{T as rt}from"./TopBarConnectButton-BV3HuR-c.js";const nt="/assets/gas-BcQTQbwx.svg",it={"adm-tabs":"_adm-tabs_100c5_1"},lt=({tabs:r,customClassName:c,getTabKey:p,defaultKey:x,titleFontSize:u})=>{const g=a.useRef(null),[v,R]=a.useState("1"),[w,A]=a.useState(1),{address:C}=fe(),z=ne.getUnPaidLength();a.useEffect(()=>{p&&p(+v)},[v,p]),a.useEffect(()=>{x!==void 0&&(A(x),_(`${x}`))},[x]);const _=d=>{var o;R(d),(o=g==null?void 0:g.current)==null||o.swipeTo(Number(d))},h=a.useCallback(async()=>{try{const o=(await X(m,{address:oe,abi:ue,functionName:"getBuyerOrderIds",args:[C,0,100]})).map(s=>Number(s)),U=o.map(s=>({address:oe,abi:ue,functionName:"allOrders",args:[s]})),W=(await y(m,{contracts:U})).map(s=>({orderId:Number(s.result[0]),seller:s.result[1],buyer:s.result[2],createTime:String(s.result[3]),status:s.result[4],orderType:s.result[5]})),$=o.map(s=>({address:T,abi:E,functionName:"internalOrders",args:[s]})),S=await y(m,{contracts:$}),V=W.map((s,L)=>({...s,price:Number(S[L].result[2])})),Q=o.map(s=>({address:T,abi:E,functionName:"getInternalOrderMachineIds",args:[s]})),Y=await y(m,{contracts:Q}),K=V.map((s,L)=>{const ae=Y[L].result.map(re=>Number(re));return{...s,machineIds:ae}});console.log("buyer list",K);const n=(await X(m,{address:oe,abi:ue,functionName:"getSellerOrderIds",args:[C,0,100]})).map(s=>Number(s)),B=n.map(s=>({address:oe,abi:ue,functionName:"allOrders",args:[s]})),b=(await y(m,{contracts:B})).map(s=>({orderId:Number(s.result[0]),seller:s.result[1],buyer:s.result[2],createTime:String(s.result[3]),status:s.result[4],orderType:2})),F=n.map(s=>({address:T,abi:E,functionName:"internalOrders",args:[s]})),G=await y(m,{contracts:F}),J=b.map((s,L)=>({...s,price:Number(G[L].result[2])})),ee=n.map(s=>({address:T,abi:E,functionName:"getInternalOrderMachineIds",args:[s]})),te=await y(m,{contracts:ee}),se=J.map((s,L)=>{const ae=te[L].result.map(re=>Number(re));return{...s,machineIds:ae}});console.log("seller list",se);let j=[...K,...se];const l=ne.getallListedOrders().map(s=>({...s,orderType:3}));j=j.filter(s=>s.machineIds.length!==0&&(s.seller===C||s.buyer===C)).concat(l).sort((s,L)=>s.status-L.status);const I=j.filter(s=>s.status===0&&(s.seller===C||s.buyer===C)&&!s.listedAt).length;ne.updateData(j,I)}catch(d){console.error(d)}},[C]);return a.useEffect(()=>{h()},[h]),e.jsxs("div",{className:"h-full relative",children:[e.jsx(he,{activeKey:v,onChange:_,stretch:!1,className:je(c,[it["adm-tabs"]],` ml-[15px]
            h-[48px] !shrink-0  [&_.adm-tabs-tab-wrapper]:flex-none [&_.adm-tabs-tab-wrapper]:px-0  
            [&_.adm-tabs-tab.adm-tabs-tab-active]:font-medium [&_.adm-tabs-tab.adm-tabs-tab-active]:opacity-100 
            [&_.adm-tabs-tab]:pb-[11px] [&_.adm-tabs-tab]:pt-[14px] [&_.adm-tabs-tab]:text-[15px] 
            [&_.adm-tabs-tab]:opacity-40 [&_.adm-tabs-tab]:transition-transform
          `),style:{"--title-font-size":`${u||"1.06rem"}`},children:r.map((d,o)=>e.jsx(he.Tab,{title:d.title,className:""},o))}),z>0&&e.jsx("div",{className:"absolute top-[.1875rem] left-[8.9rem]  bg-[red] h-[.6875rem] w-[.6875rem] p-1 rounded-3xl flex items-center justify-center text-white text-[.6rem] leading-[.6rem]"}),e.jsx(we,{className:"!h-[calc(100%-48px)] outline-0",ref:g,indicator:()=>null,tabIndex:Number(v),defaultIndex:w,onIndexChange:d=>R(`${d}`),children:r.map((d,o)=>e.jsx(we.Item,{className:"no-scrollbar max-w-full overflow-y-auto overflow-x-hidden ",children:d.children},o))})]})},Me={"adm-tabs":"_adm-tabs_14udc_1","machine-name":"_machine-name_14udc_21"},ct=r=>r/1440/360*100,dt=r=>360*(1440-ut(r))/1440,ot=r=>{const p=r/1440;return parseFloat(p.toFixed(2))},mt=r=>{var g;const c=r+"",p=Ue.SHA256(c).toString(),x=((g=p.match(/[a-zA-Z]/g))==null?void 0:g.slice(0,4).join(""))||"ABCD",u=p.slice(10,14);return(x+u).toUpperCase()},ut=r=>r!==void 0&&r>0?+H(BigInt(r)):0,xt=({item:r,onLeftClick:c,onRightClick:p})=>{const x=()=>r.producedMix!==void 0&&r.producedMix>0?+H(BigInt(r.producedMix)):0;return e.jsxs("div",{className:"bg-white rounded-2xl p-2 flex justify-between  text-[.68rem]",children:[e.jsxs("div",{className:"flex relative",onClick:()=>c(r),children:[e.jsx(Ce,{checked:r.checked,icon:u=>u?e.jsx("img",{src:Ae,alt:""}):e.jsx("div",{className:"border border-[#a5a4a4] w-[1rem] h-[1rem] rounded-[50%]"})}),e.jsx("img",{src:ve,alt:"",className:"mx-2 w-[3.625rem]"})]}),e.jsxs("div",{className:"basis-5/7  h-full flex flex-col gap-0.5",onClick:()=>p(r),children:[e.jsxs("div",{className:"flex justify-between mb-2",children:[e.jsxs("div",{className:je(Me["machine-name"],"flex rounded-3xl pr-3 text-[.5rem] items-center"),children:[e.jsxs("div",{className:"font-bold",children:["#",mt(r.id)]}),e.jsx("div",{className:"text-white ml-3",children:"矿机"})]}),e.jsx("div",{className:"text-[#15b268] flex gap-1",children:e.jsx("img",{src:r.isProducing&&r.isActivatedStakedLP?Ye:Ve,alt:"",width:50})})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("div",{children:"燃料费剩余："}),e.jsx(Re,{percent:ct(r.fuelRemainingMinutes),className:"flex-1",style:{"--fill-color":"#615371"}}),e.jsxs("div",{children:[ot(r.fuelRemainingMinutes),"天"]})]}),e.jsxs("div",{className:"flex gap-1",children:["累计产出积分：",e.jsx(P,{type:O.BALANCE,value:x(),decimalSubLen:2,className:"font-bold"}),"MIX"]}),e.jsxs("div",{className:"flex gap-1",children:["矿机生命剩余：",e.jsx(P,{type:O.BALANCE,value:dt(r.producedMix),decimalSubLen:2,className:"font-bold"}),"天"]})]})]},r.id)},ht=()=>{const[r,c]=a.useState([]),[p,x]=a.useState([]),[u,g]=a.useState([]),[v,R]=a.useState([]),[w,A]=a.useState(!1),[C,z]=a.useState(0),_=a.useRef(null),[h,d]=a.useState([]),o=ye(),[U,ie]=a.useState(["全部(0)","已启动(0)","未开机(0)"]),[W,$]=a.useState("0"),{address:S}=fe(),[V,Q]=a.useState(""),[Y,K]=a.useState(""),[le,n]=a.useState(""),[B,q]=a.useState(0),[b,F]=a.useState(!1),[G,J]=a.useState(0),[ee,te]=a.useState(0);a.useEffect(()=>{(async()=>{try{const f=await ze(m,{address:S,chainId:Ke}),M=We(f.value,f.decimals);Q(M);const N=await y(m,{contracts:[{address:Le,abi:Ne,functionName:"balanceOf",args:[S]},{address:qe,abi:Ne,functionName:"balanceOf",args:[S]},{address:me,abi:xe,functionName:"mixBalances",args:[S]}]});K(H(N[0].result)),n(H(N[1].result)),q(Number(H(N[2].result)))}catch(f){console.error(f)}})()},[S]),a.useEffect(()=>{w&&d(r),r.length===h.length&&h.length>0&&A(!0)},[w,r,h]);const se=()=>{c(i=>{const f=i.map(M=>({...M,checked:!w}));return d(w?[]:f),f}),A(!w)},j=a.useCallback(i=>{c(f=>{const M=f.map(N=>N.id===i.id?{...N,checked:!N.checked}:N);if(!i.checked)d(w?r:[...h,i]);else{const N=h.filter(ce=>ce.id!==i.id);d(N),A(!1)}return M})},[w,r,h]),l=a.useCallback(async()=>{F(!0);try{const f=(await X(m,{address:me,abi:xe,functionName:"getOwnerToMachineIds",args:[S]})).map(t=>Number(t)),M=f.map(t=>({address:me,abi:xe,functionName:"getMachineLifecycle",args:[t]})),N=(await y(m,{contracts:M})).map((t,k)=>({activatedAt:Number(t.result.activatedAt),createTime:Number(t.result.createTime),expiredAt:Number(t.result.expiredAt),destroyed:t.result.destroyed,isActivatedStakedLP:t.result.isActivatedStakedLP,isFuelPaid:t.result.isFuelPaid,isProducing:t.result.isProducing,mtype:t.result.mtype,checked:!1,status:t.status,id:f[k],lastProduceTime:Number(t.result.lastProduceTime),producedChildCount:Number(t.result.producedChildCount),producedHours:Number(t.result.producedHours),fuelRemainingMinutes:Number(t.result.fuelRemainingMinutes)})),ce=N.filter(t=>t.mtype===2&&t.isActivatedStakedLP),_e=ce.map(t=>({address:Qe,abi:et,functionName:"viewMachineProduction",args:[t.id]})),de=await y(m,{contracts:_e}),D=ce.map((t,k)=>de[k].status==="success"?{...t,unclaimedChildCount:Number(de[k].result[2]),producedMix:Number(de[k].result[3]),unclaimedMix:Number(de[k].result[5])}:{...t,unclaimedChildCount:0,producedMix:0,unclaimedMix:0}),De=N.map(t=>({address:me,abi:xe,functionName:"_isOnSale",args:[t.id]})),He=await y(m,{contracts:De});let pe=N.map((t,k)=>({...t,isOnSale:He[k].result})).filter(t=>{if(t.mtype===1)return!t.isOnSale;if(t.mtype===2)return!t.isActivatedStakedLP&&!t.isOnSale});pe=pe.filter(t=>!t.destroyed),te(pe.length);const Fe=D.reduce((t,k)=>t+k.unclaimedMix,0);J(+H(BigInt(Fe))),g(D.filter(t=>t.isProducing&&t.isActivatedStakedLP)),R(D.filter(t=>!t.isProducing&&t.isActivatedStakedLP)),x(D),ie([`全部(${D.length})`,`已启动(${D.filter(t=>t.isProducing&&t.isActivatedStakedLP).length})`,`未开机(${D.filter(t=>!t.isProducing&&t.isActivatedStakedLP).length})`]),c(D),console.log("start machine list",D.filter(t=>t.isProducing&&t.isActivatedStakedLP)),console.log("not Turned On machine list",v)}catch(i){console.log(i)}finally{F(!1)}},[S]);a.useEffect(()=>{l()},[l]),a.useEffect(()=>{h.length===r.length&&h.length>0?A(!0):A(!1)},[h.length,r.length]);const I=i=>{o("/user/machineDetail",{state:i})},s=a.memo(({index:i,style:f,data:M})=>{const Z=M[i];return e.jsx("div",{style:{...f,height:"70px"},children:e.jsx(xt,{item:Z,onLeftClick:j,onRightClick:I})})});a.useEffect(()=>{if(!_.current)return;const i=()=>{const Z=window.innerHeight-100;z(Z)};return i(),window.addEventListener("resize",i),()=>window.removeEventListener("resize",i)},[]);const L=async()=>{if(h.length===0){Ie.show({content:"请选择要添加燃料的矿机",position:"center",duration:2e3});return}o("/user/addFuel",{state:h})},ae=i=>i?e.jsx("img",{src:Ae,alt:"",width:16,height:16}):e.jsx("div",{className:"border border-[#a5a4a4] w-[1rem] h-[1rem] rounded-[50%]"}),re=()=>{o("/user/toBeActivatedMachine")},ke=a.useCallback(async()=>{o("/user/claimMix",{state:{machineList:r,mixPointsToBeClaimed:G}})},[r,G,o]),Te=()=>{o("/user/mixBill")},Ee=()=>{o("/user/exchangeIdx")},Pe=()=>{o("/user/syntheticMachine")},Oe=i=>{$(i),i==="0"&&c(p),i==="1"&&c(u),i==="2"&&c(v)};return e.jsxs("div",{className:" flex flex-col justify-between",children:[e.jsxs("div",{className:"px-[21px] ",children:[e.jsxs("div",{className:"bg-[#09090a] rounded-2xl text-white px-4 py-2 text-[1rem] relative",children:[e.jsx("div",{className:"text-[#c6c6c6] text-[12px] font-[400] flex",children:"钱包余额"}),e.jsxs("div",{className:"flex mt-1 mb-1 items-center gap-1",children:[e.jsx("img",{src:Ge,alt:"",width:16,height:16}),e.jsx("div",{className:"text-[#c6c6c6] text-[10px] font-[400] w-[27px]",children:"USDT"}),e.jsx("div",{children:e.jsx(P,{type:O.BALANCE,value:le,decimalSubLen:2,className:"ml-2 mr-1.5"})})]}),e.jsxs("div",{className:"flex my-1 items-center  gap-1",children:[e.jsx("img",{src:Je.bscSvg,alt:"",width:16,height:16}),e.jsx("span",{className:"text-[#c6c6c6] text-[10px] font-[400] w-[27px]",children:"BNB"}),e.jsx("div",{children:e.jsx(P,{type:O.BALANCE,value:V,decimalSubLen:2,className:"ml-2 mr-1.5"})})]}),e.jsxs("div",{className:"flex  gap-1  mb-2 items-center",children:[e.jsx("div",{className:"bg-[#895eff] rounded-[50%] text-[7px] flex items-center justify-center w-[16px] h-[16px]",children:"IDX"}),e.jsx("span",{className:"text-[#c6c6c6] text-[10px] font-[400] w-[27px]",children:"IDX"}),e.jsx("div",{children:e.jsx(P,{type:O.BALANCE,value:Y,decimalSubLen:2,className:"ml-2 mr-1.5  font-bold"})})]}),e.jsx("img",{src:Ze,alt:"",width:71,height:87,className:"absolute top-[2.5rem] right-[2.5rem]"})]}),e.jsxs("div",{className:"bg-black rounded-2xl text-white p-4 text-[1rem] mt-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"bg-[#0B8659] rounded-[50%] text-[7px] flex items-center justify-center  w-[16px] h-[16px]",children:"MIX"}),e.jsxs("div",{children:[e.jsx(P,{type:O.BALANCE,value:B,decimalSubLen:2,className:"ml-2 mr-1.5"}),e.jsx("span",{className:"text-[#c6c6c6] text-[10px] font-[400]",children:"MIX"})]})]}),e.jsxs("div",{className:"flex gap-2 text-[10px] items-center",onClick:Te,children:["账单",e.jsx("div",{className:"w-[16px] h-[18px] bg-[#333] rounded-[50%] text-[.6875rem] flex items-center justify-center ",children:"i"})]})]}),e.jsxs("div",{className:"flex gap-2 text-[#c6c6c6] mt-4",children:[e.jsx("div",{onClick:Pe,className:"flex-[1] text-center bg-[#09090a] border border-[#212122] rounded-3xl py-1 text-[.7rem]",children:"合成矿机"}),e.jsx("div",{onClick:Ee,className:"flex-[1] text-center bg-[#09090a] border border-[#212122] rounded-3xl py-1 text-[.7rem]",children:"兑换IDX"})]})]}),e.jsxs("div",{className:"flex mt-2 items-center   text-[#C7BEDF] gap-2",children:[e.jsx(be,{onClick:ke,className:"flex-1/2 !bg-[#09090a] !rounded-2xl  !mb-2  !items-center  !py-1 ",children:e.jsxs("div",{className:"flex flex-col !text-[#C7BEDF] ",children:[e.jsx(P,{type:O.BALANCE,value:G,decimalSubLen:2,className:"ml-2 mr-1.5 text-[#895EFE] font-bold text-[1rem]"}),e.jsx("div",{className:"text-[.75rem]",children:"挖矿产出（MIX）"})]})}),e.jsx(be,{onClick:re,className:"flex-1/2 !bg-[#09090a] !rounded-2xl  !mb-2  !items-center  !py-1 ",children:e.jsxs("div",{className:"flex flex-col !text-[#C7BEDF] text-[.75rem]",children:[e.jsx("div",{className:"ml-2 mr-1.5 text-[#895EFE] font-bold text-[1rem]",children:ee}),e.jsx("div",{className:"text-[.75rem]",children:"矿机管理（个）"})]})})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(Ce,{className:"mr-6 h-[36px] ",checked:w,icon:i=>ae(i),onClick:se,style:{"--font-size":"12px","--gap":"6px",padding:"8px 0 10px"},children:"全选"}),e.jsx(ge,{direction:"vertical",style:{borderColor:"#666",height:"15px"}})]}),e.jsx(he,{activeKey:W,onChange:Oe,style:{"--active-line-height":"0"},className:`
                  ${Me["adm-tabs"]}
                  !h-[40px] !shrink-0  
                  [&_.adm-tabs-tab-wrapper]:flex-none [&_.adm-tabs-tab-wrapper]:px-0  
                  [&_.adm-tabs-tab.adm-tabs-tab-active]:font-bold [&_.adm-tabs-tab.adm-tabs-tab-active]:opacity-100 
                  [&_.adm-tabs-tab]:text-[12px]
                  [&_.adm-tabs-tab]:pb-[11px] 
                  [&_.adm-tabs-tab]:pt-[14px] 
                  [&_.adm-tabs-tab]:opacity-40 [&_.adm-tabs-tab]:transition-transform
                `,children:U.map((i,f)=>e.jsx(he.Tab,{title:i,className:"flex flex-col"},f))})]}),e.jsx("div",{ref:_,style:{height:`${C}px`},className:"no-scrollbar mb-[4rem]",children:b?e.jsx(Xe.Paragraph,{lineCount:6,animated:!0,className:"customSkeleton"}):r.length>0?e.jsx(Se,{height:C,width:"100%",itemCount:r.length,itemSize:100,itemData:r,children:s}):e.jsx(Be,{})})]}),e.jsxs("div",{className:"absolute bottom-0 left-0 right-0 w-full bg-white  py-[.75rem] flex items-center mt-auto px-[21px]",onClick:L,children:[h.length>0&&e.jsx("div",{className:"bg-[#F1F1F3] rounded-[50%] w-[32px] h-[32px] flex justify-center items-center text-[#895FFE] font-bold",children:h.length}),e.jsxs("div",{className:"flex flex-col items-center justify-center  mx-auto",children:[e.jsx("img",{src:nt,alt:"",width:18}),e.jsx("span",{className:"text-[.8125rem] mt-1",children:"添加燃料"})]})]})]})},ft=({isShow:r})=>{const[c,p]=a.useState(""),{address:x}=fe(),[u,g]=a.useState([]),v=ye(),R=ne.getUnPaidLength(),w=n=>{p(n)},[A,C]=a.useState(0),z=a.useRef(null),[_,h]=a.useState(0),[d,o]=a.useState(0),[U,ie]=a.useState(0),W=a.useCallback(async()=>{try{const n=await X(m,{address:Le,abi:Ne,functionName:"balanceOf",args:[x]});h(+H(n))}catch(n){console.error(n)}},[x]),$=a.useCallback(async()=>{try{const n=await X(m,{address:T,abi:E,functionName:"CHILD_MACHINE_PRICE",args:[]});o(Number(n))}catch(n){console.error(n)}},[]);a.useEffect(()=>{r&&$()},[$,r]),a.useEffect(()=>{r&&W()},[W,r]),a.useEffect(()=>{if(!z.current)return;const n=()=>{const b=window.innerHeight-100;C(b)};return n(),window.addEventListener("resize",n),()=>window.removeEventListener("resize",n)},[]);const S=()=>{if(+c==0){Ie.show({content:"请输入购买数量",position:"center"});return}v("/user/myOrders",{state:u.filter((n,B)=>B<+c)})},V=({index:n,style:B,data:q})=>{const b=q[n],F=()=>{if(b.seller===x)v("/user/myPublishMachineTx",{state:b});else return};return e.jsx("div",{style:{...B,height:"70px"},children:e.jsxs("div",{className:je([b.seller!==x?"px-[.9375rem]":"pl-[.9375rem]"]," py-[.9375rem] bg-white rounded-3xl flex mt-2 gap-2"),onClick:F,children:[e.jsx("img",{src:ve,alt:"",className:"w-[3.625rem]"}),e.jsxs("div",{className:"flex text-[.625rem]",children:[e.jsxs("div",{className:"w-[70px] flex flex-col gap-1 text-[#5B5B5B]",children:[e.jsx("div",{children:"出售中"}),e.jsx("div",{children:"矿机卖家:"}),e.jsx("div",{children:"上架时间:"})]}),e.jsxs("div",{className:"ml-auto w-[73%] font-bold flex flex-col gap-1",children:[e.jsx("div",{children:"..."}),e.jsx("div",{children:st(b.seller,4)}),e.jsx("div",{children:at(b.listedAt)})]})]}),b.seller!==x?e.jsxs("div",{className:"ml-auto mt-auto font-bold text-[.75rem]",children:["NO.",b.NO]}):e.jsxs("div",{className:"flex",children:[e.jsxs("div",{className:"flex flex-col justify-between items-center",children:[e.jsx("div",{className:"bg-[#895EFF] rounded-2xl px-2 text-white text-[.625rem]",children:"我发布的"}),e.jsxs("div",{className:"text-[#895EFF] text-[.75rem]",children:["NO.",b.NO]})]}),e.jsx("img",{src:tt,alt:"",width:20})]})]})})},Q=a.useCallback(async()=>{try{const n=await X(m,{address:T,abi:E,functionName:"activeListedOrderCount",args:[]}),B=new Array(Number(n)).fill(1).map((l,I)=>({address:T,abi:E,functionName:"allListedOrderIds",args:[I]})),F=(await y(m,{contracts:B})).map(l=>Number(l.result)).map(l=>({address:T,abi:E,functionName:"listedOrders",args:[l]})),J=(await y(m,{contracts:F})).map(l=>({orderId:Number(l.result[0]),machineId:Number(l.result[1]),seller:l.result[2],priceInIdx:+H(l.result[3]),listedAt:Number(l.result[4]),status:Number(l.result[5])})),ee=J.map(l=>({address:T,abi:E,functionName:"internalOrders",args:[l.orderId]})),te=await y(m,{contracts:ee});let j=J.map((l,I)=>({...l,buyer:te[I].result[1]})).filter(l=>l.status===0&&l.seller!=="0x0000000000000000000000000000000000000000");console.log("itemListWithBuyer",j),ne.updateAllListedOrders(j),j=j.sort((l,I)=>l.listedAt-I.listedAt).map((l,I)=>({...l,NO:I+1})),g(j),console.log("user machine tx list",j)}catch(n){console.error(n)}},[]);a.useEffect(()=>{Q()},[Q]);const Y=async()=>{try{const n=await X(m,{address:T,abi:E,functionName:"getIDXAmount",args:[1]});ie(Number(H(n)))}catch(n){console.error(n)}};a.useEffect(()=>{Y()},[]);const K=()=>+c>u.length?"库存不足":_<+c*d?"余额不足":"去支付",le=()=>{v("/user/history")};return e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"px-[21px]",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-[15px]",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("div",{className:"flex gap-3 items-center",children:[e.jsx("img",{src:ve,alt:"",className:"w-[2.5625rem]"}),e.jsxs("div",{className:"text-[.6875rem]",children:[e.jsx("div",{children:"类型： 矿机"}),e.jsxs("div",{children:[e.jsx(P,{type:O.BALANCE,value:d*U,decimalSubLen:2,className:"font-bold text-[1.25rem] mr-2"}),"IDX/台 ≈ ",d,"USDT/台"]})]})]}),e.jsxs("div",{className:"flex h-[40px]",onClick:le,children:[e.jsx("div",{className:"pt-[.3125rem] text-[14px] font-bold",children:"交易记录"}),R>0&&e.jsx("div",{className:"bg-[red]  p-1 rounded-3xl h-[15px] flex items-center justify-center text-white text-[.6rem] leading-[.6rem]",children:R})]})]}),e.jsx(ge,{className:"!my-3"}),e.jsx("h1",{className:"font-bold text-[.875rem] mb-2",children:"矿机权益"}),e.jsxs("div",{className:"text-[.75rem] ",children:[e.jsxs("div",{className:"pl-[2.5rem] relative",children:[e.jsx("div",{children:"每台矿机每日产出4个MIX积分，每日00:00:00-01:00:00到账;"}),e.jsx("div",{className:"absolute left-[25px] top-[5px] bg-black w-[7px] h-[7px] rounded-[50%]"})]}),e.jsxs("div",{className:"pl-[2.5rem] flex gap-2 text-[.75rem] relative",children:[e.jsx("div",{children:"每80个MIX积分合成1台矿机，合成出来的矿机，可转让或保留用于挖取积分；"}),e.jsx("div",{className:"absolute left-[25px] top-[5px] bg-black w-[7px] h-[7px] rounded-[50%]"})]})]}),e.jsx(ge,{}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-[100px] text-[.875rem]  font-bold",children:"购买数量"}),e.jsxs("div",{className:"relative flex-1",children:[e.jsx($e,{placeholder:"输入整数",style:{"--font-size":".875rem"},className:"!bg-[#f3f3f3] rounded-3xl px-4 py-1 ",value:c,type:"number",onChange:w}),e.jsx("span",{className:"absolute right-[20px] top-[.3125rem] text-[.875rem]",children:"台"})]})]}),e.jsxs("div",{className:"flex justify-end mt-1 gap-1 text-[.625rem] items-end",children:["钱包余额：",e.jsx(P,{type:O.BALANCE,value:_,decimalSubLen:2,className:"font-bold text-[.6875rem]"}),"IDX"]})]}),e.jsx("div",{ref:z,style:{height:`${A}px`},className:"no-scrollbar mb-[4rem]",children:u.length>0?e.jsx(Se,{height:A,width:"100%",itemCount:u.length,itemSize:95,itemData:u,children:V}):e.jsx(Be,{})})]}),e.jsxs("div",{className:"w-full bg-white h-[4rem] flex items-center absolute bottom-0 px-[1.875rem]",children:[e.jsxs("div",{children:[e.jsx("div",{children:"待支付 IDX"}),e.jsx("div",{className:"text-[#FF6D6D] text-[20px] font-bold",children:e.jsx(P,{type:O.BALANCE,value:+c*d*U,decimalSubLen:2,className:"mr-1.5  font-bold"})})]}),e.jsx(be,{className:"!bg-black !text-white !rounded-3xl !ml-auto   !h-[40px] !w-[100px]",style:{fontSize:"15px"},onClick:S,disabled:_<+c*d*U||+c>u.length,children:K()})]})]})},Ot=()=>{const[r,c]=a.useState(0),p=[{title:"首页",children:e.jsx(ht,{})},{title:"矿机交易",children:e.jsx(ft,{isShow:r===1})}],x=v=>{c(v)},{isConnected:u}=fe(),g=ye();return a.useEffect(()=>{u||g("/")},[u,g]),e.jsxs("div",{className:"pt-2 h-full overflow-hidden relative",children:[e.jsx(lt,{tabs:p,customClassName:"w-[50%]",getTabKey:x,defaultKey:0,titleFontSize:"1rem"}),e.jsx("div",{className:"absolute top-[1.25rem] right-[1.25rem]",children:e.jsx(rt,{})})]})};export{Ot as default};
