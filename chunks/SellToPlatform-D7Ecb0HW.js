import{i as v,K as y,r as a,l as m,j as s,B as x,p as w,s as A,v as T,q as p}from"./vendor-CR9QeBO-.js";import{a as C}from"./arrow-Dt4f_FJz.js";import{u as M}from"./user-machine-DxW_ZeqC.js";import{A as L,N as k}from"./index-CwKQTuFo.js";import{c as r}from"../assets/index-CclTo9Qo.js";import{S as h,L as B,C as D}from"./index-BmXiOrEl.js";import{s as E}from"./helper-CPLEapGt.js";import{M as u}from"./MiningMachineSystemStorage-v65BGZKl.js";import{M as P}from"./MiningMachineSystemLogic-BvMT4rBv.js";const _=()=>{const n=v(),f=y(),[c,i]=a.useState(!1),[l,g]=a.useState(0),N=async()=>{try{const e=await m(r,{address:B,abi:P,functionName:"getIDXAmount",args:[1]}),S=w(e);g(+S)}catch(e){console.error(e)}};a.useEffect(()=>{N()},[]);const j=()=>{n("/user")},t=f.state,[o,b]=a.useState(0),d=a.useCallback(async()=>{try{const e=await m(r,{address:h,abi:u,functionName:"getMachineLifecycle",args:[t.machineId]});b(16*(1-Number(e.producedHours)/360))}catch(e){console.error(e)}},[t.machineId]);a.useEffect(()=>{d()},[d]);const I=async()=>{try{i(!0);const e=await A(r,{address:h,abi:u,functionName:"sellToPlatform",args:[t.machineId]});await T(r,{hash:e,chainId:D}),p.show({content:"卖出成功",position:"center"}),n("/user")}catch(e){p.show({content:"卖出失败，请稍后再试",position:"center"}),console.error(e)}finally{i(!1)}};return s.jsxs("div",{className:"px-[21px]",children:[s.jsxs("div",{className:"flex pt-4 mb-4",children:[s.jsx(x,{onClick:j,className:"!p-[0] !rounded-2xl",loading:c,children:s.jsx("img",{src:C,alt:""})}),s.jsx("span",{className:"m-auto text-[19px] font-bold",children:"卖给平台"})]}),s.jsxs("div",{className:"rounded-3xl bg-white p-4",children:[s.jsxs("div",{className:"flex gap-2 items-center",children:[s.jsx("img",{src:M,alt:"",width:51}),s.jsxs("div",{children:[s.jsx("div",{className:"flex flex-col justify-between py-1",children:s.jsxs("div",{children:[s.jsx("span",{className:"text-[20px] font-bold mr-1",children:o*l}),"IDX/台 ≈",o,"USDT/台"]})}),s.jsxs("div",{children:["矿机卖家：",s.jsx("span",{className:"font-bold",children:E(t.seller,4)})]})]})]}),s.jsxs("div",{className:"mt-2 text-end pr-[.625rem]",children:["合计：",s.jsx(L,{type:k.BALANCE,value:o*l,decimalSubLen:2,className:"font-bold text-[20px] mr-1"}),"IDX"]}),s.jsx(x,{style:{"--background-color":"black","--text-color":"white",width:"100%",marginTop:"20px",fontSize:"14px"},shape:"rounded",onClick:I,loading:c,children:"卖出"})]})]})};export{_ as default};
