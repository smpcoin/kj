import{u as C,i as S,r as s,j as l,k as y,l as w,O as j}from"./vendor-CR9QeBO-.js";import{T as E}from"./TopBarConnectButton-BV3HuR-c.js";import{S as g}from"./index-CS9n0aoQ.js";import{c as h}from"../assets/index-UMXjEvK5.js";import{M as p}from"./MiningMachineSystemStorage-v65BGZKl.js";const R=()=>{const{isConnected:e}=C(),t=S();return s.useEffect(()=>{e||t("/")},[e,t]),l.jsx("div",{className:"flex justify-between py-2 px-[21px] bg-white",children:l.jsx(E,{})})};function W(){const{address:e,connector:t,isConnected:a}=C(),{disconnect:f}=y(),r=S(),i=s.useRef(),u=s.useRef(!1);s.useEffect(()=>{if(!a){i.current=void 0;return}if(!i.current){i.current=e;return}e&&i.current!==e&&!u.current&&(u.current=!0,console.log(`Wallet address changed from ${i.current} to ${e}`),r("/"),setTimeout(()=>window.location.reload(),500)),i.current=e},[e,a,f,r]),s.useEffect(()=>{var m;if(!a)return;const d=n=>{const c=n[0];c&&e&&c.toLowerCase()!==e.toLowerCase()&&(console.log("aaaaa"),r("/"),setTimeout(()=>window.location.reload(),500))};if(window.ethereum&&window.ethereum.on("accountsChanged",d),(t==null?void 0:t.id)==="walletConnect"){const n=(m=window.WalletConnect)==null?void 0:m.provider;n&&(n.on("accountsChanged",d),n.on("disconnect",()=>{console.log("bbbbb"),r("/")}))}return()=>{var n;if(window.ethereum&&window.ethereum.removeListener("accountsChanged",d),(t==null?void 0:t.id)==="walletConnect"){const c=(n=window.WalletConnect)==null?void 0:n.provider;c&&(c.removeListener("accountsChanged",d),c.removeListener("disconnect",()=>{}))}}},[a,e,t,f,r])}const P=()=>{const{isConnected:e,address:t}=C(),[a,f]=s.useState(null),[r,i]=s.useState(null),[u,d]=s.useState(null),m=async()=>{try{const o=await w(h,{address:g,abi:p,functionName:"sadmin"});f(o)}catch(o){console.error(o)}};s.useEffect(()=>{m()},[]);const n=s.useMemo(()=>e?t===a:!1,[t,e,a]),c=s.useMemo(()=>e?t===r:!1,[t,e,r]),[A,x]=s.useState(!1),b=s.useCallback(async()=>{try{const o=await w(h,{address:g,abi:p,functionName:"platformWallet",args:[]});i(o)}catch(o){console.log(o)}},[]);s.useEffect(()=>{b()},[b]);const v=s.useCallback(async()=>{try{const o=await w(h,{address:g,abi:p,functionName:"isMotherMachineDistributor",args:[t]});d(o)}catch(o){console.log(o)}},[t]);return s.useEffect(()=>{v()},[v]),s.useEffect(()=>{e?a!==null&&r!==null&&u!==null&&x(n||c||u):x(!1)},[e,n,a,c,r,u]),W(),l.jsx(l.Fragment,{children:l.jsxs("main",{className:"flex w-full flex-col h-screen",children:[A&&l.jsx(R,{}),l.jsx(j,{})]})})};export{P as default};
